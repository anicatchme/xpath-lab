<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>XPath Lab — EDI ASN (Shipping Notice)</title>
<style>
  :root{--brand:#0366d6;--bg:#fff;--muted:#666}
  body{font-family:Segoe UI,Arial,Helvetica,sans-serif;margin:0;background:#f6f8fb;color:#111}
  .wrap{max-width:1100px;margin:20px auto;padding:18px;background:var(--bg);border-radius:8px;box-shadow:0 2px 8px rgba(20,30,40,0.05)}
  header{display:flex;align-items:flex-start;justify-content:space-between;gap:16px}
  h1{margin:0;color:var(--brand);font-size:20px}
  p.lead{margin:6px 0 0;color:var(--muted)}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:16px}
  .panel{background:#fff;padding:12px;border-radius:6px;border:1px solid #eef3fb}
  pre.xml{background:#0b1220;color:#cfe8ff;padding:12px;overflow:auto;border-radius:6px;font-family:Consolas,Menlo,monospace;font-size:13px;line-height:1.4}
  label{display:block;margin:8px 0 6px;font-weight:600;color:#333}
  input.xpath{width:100%;padding:8px;border-radius:6px;border:1px solid #dfeaf8;font-size:14px}
  .btn{display:inline-block;padding:8px 12px;border-radius:6px;background:var(--brand);color:#fff;text-decoration:none;border:none;cursor:pointer}
  .btn.ghost{background:#f3f8ff;color:var(--brand);border:1px solid #dbeefe}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .small{font-size:13px;color:var(--muted)}
  .results{margin-top:10px;background:#fbfcff;border:1px dashed #e3eefc;padding:10px;border-radius:6px;min-height:80px;overflow:auto}
  .task{margin-bottom:12px;padding:10px;border-radius:6px;border:1px solid #f0f4fb;background:#fbfeff}
  .solutions{margin-top:10px;background:#fff7f0;border-left:4px solid #ffb86b;padding:10px;border-radius:4px}
  .hint{font-size:13px;color:#666}
  .example-btn{font-size:13px;padding:6px 8px}
  .footer{margin-top:18px;color:var(--muted);font-size:13px}
  details{margin-top:8px}
  .code-inline{font-family:Consolas,monospace;background:#f5f7fb;padding:2px 6px;border-radius:4px;color:#0a2540}
</style>
</head>
<body>
<div class="wrap" role="main">
  <header>
    <div>
      <h1>Lab — EDI ASN (Advanced Shipping Notice)</h1>
      <p class="lead">Practice extracting shipment and package details from an ASN. Useful for logistics, warehousing, and reconciliation tasks.</p>
    </div>
    <div style="text-align:right">
      <div class="small">Difficulty: <strong>Intermediate</strong></div>
      <div class="small">Estimated time: <strong>20–35 min</strong></div>
    </div>
  </header>

  <div class="grid" role="region" aria-label="lab grid">
    <!-- Left column -->
    <div>
      <div class="panel">
        <h3 style="margin:0 0 8px">How to use</h3>
        <ol style="margin:6px 0 0 18px">
          <li>Read tasks below.</li>
          <li>Type an XPath in the tester on the right and click <strong>Run</strong>.</li>
          <li>Use examples or reveal solutions when stuck.</li>
        </ol>
        <div style="margin-top:10px" class="hint">Note: This tester uses the browser XPath engine (XPath 1.0). Namespaces are not used in this sample — advanced labs will add namespaces.</div>
      </div>

      <div style="margin-top:12px" class="panel">
        <h3 style="margin:0 0 8px">ASN — Sample XML</h3>
        <div class="small">Download as <span class="code-inline">asn-sample.xml</span> if needed.</div>
        <pre class="xml" id="xmlSample" aria-label="ASN sample XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;AdvancedShippingNotice&gt;
  &lt;Header&gt;
    &lt;ASNNumber&gt;ASN-2025-7001&lt;/ASNNumber&gt;
    &lt;ShipmentDate&gt;2025-12-10&lt;/ShipmentDate&gt;
    &lt;Carrier&gt;FastShip&lt;/Carrier&gt;
    &lt;CarrierSCAC&gt;FSHP&lt;/CarrierSCAC&gt;
    &lt;Origin&gt;
      &lt;Name&gt;SupplyCo&lt;/Name&gt;
      &lt;Location&gt;Gotham&lt;/Location&gt;
    &lt;/Origin&gt;
    &lt;Destination&gt;
      &lt;Name&gt;Acme Corp Warehouse&lt;/Name&gt;
      &lt;Location&gt;Metropolis&lt;/Location&gt;
    &lt;/Destination&gt;
  &lt;/Header&gt;

  &lt;Shipments&gt;
    &lt;Shipment id="S1"&gt;
      &lt;ReferencePO&gt;PO-2025-00123&lt;/ReferencePO&gt;
      &lt;Packages&gt;
        &lt;Package id="P1"&gt;
          &lt;Tracking&gt;TRK-10001&lt;/Tracking&gt;
          &lt;Weight unit="KG"&gt;12.5&lt;/Weight&gt;
          &lt;Items&gt;
            &lt;LineRef lineNumber="1"&gt;2&lt;/LineRef&gt;
            &lt;LineRef lineNumber="2"&gt;1&lt;/LineRef&gt;
          &lt;/Items&gt;
        &lt;/Package&gt;

        &lt;Package id="P2"&gt;
          &lt;Tracking&gt;TRK-10002&lt;/Tracking&gt;
          &lt;Weight unit="KG"&gt;5.0&lt;/Weight&gt;
          &lt;Items&gt;
            &lt;LineRef lineNumber="3"&gt;1&lt;/LineRef&gt;
          &lt;/Items&gt;
        &lt;/Package&gt;
      &lt;/Packages&gt;
    &lt;/Shipment&gt;

    &lt;Shipment id="S2"&gt;
      &lt;ReferencePO&gt;PO-2025-00456&lt;/ReferencePO&gt;
      &lt;Packages&gt;
        &lt;Package id="P3"&gt;
          &lt;Tracking&gt;TRK-10003&lt;/Tracking&gt;
          &lt;Weight unit="KG"&gt;22.0&lt;/Weight&gt;
          &lt;Items&gt;
            &lt;LineRef lineNumber="4"&gt;2&lt;/LineRef&gt;
            &lt;LineRef lineNumber="5"&gt;3&lt;/LineRef&gt;
          &lt;/Items&gt;
        &lt;/Package&gt;
      &lt;/Packages&gt;
    &lt;/Shipment&gt;
  &lt;/Shipments&gt;

  &lt;Summary&gt;
    &lt;TotalShipments&gt;2&lt;/TotalShipments&gt;
    &lt;TotalPackages&gt;3&lt;/TotalPackages&gt;
    &lt;TotalWeight unit="KG"&gt;39.5&lt;/TotalWeight&gt;
  &lt;/Summary&gt;
&lt;/AdvancedShippingNotice&gt;</pre>
      </div>

      <div style="margin-top:12px">
        <div class="panel">
          <h3 style="margin:0 0 8px">Lab Tasks — ASN</h3>

          <div class="task">
            <h4>Task 1 — Header & summary</h4>
            <ol style="margin:6px 0 0 18px">
              <li>Get the ASN Number and Shipment Date.</li>
              <li>Get Carrier and Carrier SCAC.</li>
              <li>Get Total Shipments and Total Packages from Summary.</li>
            </ol>
          </div>

          <div class="task">
            <h4>Task 2 — Package & item queries</h4>
            <ol style="margin:6px 0 0 18px">
              <li>Get the tracking number for package with id="P2".</li>
              <li>List package ids for shipment id="S1".</li>
              <li>List all LineRef elements (line numbers) across all packages.</li>
            </ol>
          </div>

          <div class="task">
            <h4>Task 3 — Filtering & aggregation</h4>
            <ol style="margin:6px 0 0 18px">
              <li>Find packages where weight &gt; 10 KG (show package id &amp; tracking).</li>
              <li>Sum total weight using XPath (if supported): <code>sum(//Weight)</code>.</li>
              <li>Count how many LineRef entries reference lineNumber="2".</li>
            </ol>
          </div>

          <div class="task">
            <h4>Task 4 — Cross-checks & validation</h4>
            <ol style="margin:6px 0 0 18px">
              <li>Verify Summary &lt;TotalPackages&gt; equals the number of &lt;Package&gt; nodes.</li>
              <li>Find shipments referencing PO <code>PO-2025-00123</code>.</li>
            </ol>
          </div>

          <details>
            <summary style="cursor:pointer;font-weight:600">Show solutions (click to reveal)</summary>
            <div class="solutions">
              <div><strong>Answers (XPath expressions)</strong></div>
              <ol style="margin:6px 0 0 18px">
                <li><code>//Header/ASNNumber/text()</code> &amp; <code>//Header/ShipmentDate/text()</code></li>
                <li><code>//Header/Carrier/text()</code> &amp; <code>//Header/CarrierSCAC/text()</code></li>
                <li><code>//Summary/TotalShipments/text()</code> &amp; <code>//Summary/TotalPackages/text()</code></li>

                <li><code>//Shipments/Shipment/Packages/Package[@id='P2']/Tracking/text()</code></li>
                <li><code>//Shipments/Shipment[@id='S1']/Packages/Package/@id</code> (or serialize nodes)</li>
                <li><code>//Shipments/Shipment/Packages/Package/Items/LineRef/text()</code></li>

                <li><code>//Shipments/Shipment/Packages/Package[number(Weight) &gt; 10]</code> then show id/tracking; example: <code>//Shipments/Shipment/Packages/Package[number(Weight) &gt; 10]/@id</code></li>
                <li><code>sum(//Weight)</code></li>
                <li><code>count(//LineRef[@lineNumber='2'])</code></li>

                <li><code>count(//Shipments/Shipment/Packages/Package)  // compare to //Summary/TotalPackages/text()</code></li>
                <li><code>//Shipments/Shipment[ReferencePO='PO-2025-00123']</code></li>
              </ol>
              <div class="hint" style="margin-top:8px">Note: numeric comparisons may require <code>number()</code> depending on the XPath engine. Browser XPath may treat element text as numbers in numeric contexts.</div>
            </div>
          </details>

        </div>
      </div>

      <div class="footer small">Lab author: XPath Workshop — extend for namespace-aware ASN formats in advanced modules.</div>
    </div>

    <!-- Right column: interactive tester -->
    <aside>
      <div class="panel" aria-label="XPath tester">
        <label for="xpathInput">Type XPath expression</label>
        <input id="xpathInput" class="xpath" value="//Header/ASNNumber/text()" aria-label="XPath expression"/>
        <div class="controls" style="margin-top:8px">
          <button id="runBtn" class="btn">Run</button>
          <button id="clearBtn" class="btn ghost" style="color:var(--brand)">Clear</button>
          <button id="examplesBtn" class="btn ghost" title="Insert example XPaths">Examples</button>
        </div>

        <div style="margin-top:10px" class="small">Results (<span id="resultCount">0</span>)</div>
        <div id="results" class="results" role="region" aria-live="polite"></div>

        <details style="margin-top:10px">
          <summary style="cursor:pointer">Examples</summary>
          <div style="margin-top:8px;display:flex;flex-direction:column;gap:6px">
            <button class="example-btn btn ghost" data-xpath="//Header/ASNNumber/text()">ASN Number</button>
            <button class="example-btn btn ghost" data-xpath="//Shipments/Shipment[@id='S1']/Packages/Package/@id">Packages in S1</button>
            <button class="example-btn btn ghost" data-xpath="//Shipments/Shipment/Packages/Package[Weight &gt; 10]/@id">Packages Weight &gt; 10</button>
            <button class="example-btn btn ghost" data-xpath="count(//LineRef)">Count LineRefs</button>
            <button class="example-btn btn ghost" data-xpath="//Shipments/Shipment[ReferencePO='PO-2025-00123']">Shipments for PO-2025-00123</button>
          </div>
        </details>

      </div>

      <div style="margin-top:12px" class="panel">
        <h4 style="margin:0 0 8px">Tester notes</h4>
        <ul style="margin:6px 0 0 18px" class="small">
          <li>Run expressions against the sample XML shown on the left.</li>
          <li>Element text nodes and serialized elements are shown.</li>
          <li>Use <code>number()</code> or numeric casts for robust comparisons if your XPath engine requires it.</li>
        </ul>
      </div>

    </aside>
  </div>
</div>

<script>
(function(){
  // Grab sample XML from the pre block
  const xmlText = document.getElementById('xmlSample').textContent.trim();
  let xmlDoc = null;
  function parseXML() {
    try {
      const parser = new DOMParser();
      xmlDoc = parser.parseFromString(xmlText, "application/xml");
      const parsererror = xmlDoc.getElementsByTagName('parsererror');
      if (parsererror.length) {
        throw new Error('XML parse error');
      }
    } catch (e) {
      xmlDoc = null;
      console.error('XML parse failed', e);
    }
  }
  parseXML();

  function evaluate(xpath) {
    if (!xmlDoc) return { error: 'XML not parsed' };
    try {
      const nsResolver = xmlDoc.createNSResolver(xmlDoc.documentElement);
      const numberResult = xmlDoc.evaluate(xpath, xmlDoc, nsResolver, XPathResult.NUMBER_TYPE, null);
      if (!isNaN(numberResult.numberValue) && String(numberResult.numberValue) !== 'NaN') {
        return { type: 'number', value: numberResult.numberValue };
      }
      const stringResult = xmlDoc.evaluate(xpath, xmlDoc, nsResolver, XPathResult.STRING_TYPE, null);
      if (stringResult.stringValue && stringResult.stringValue !== '') {
        return { type: 'string', value: stringResult.stringValue };
      }
      const nodes = xmlDoc.evaluate(xpath, xmlDoc, nsResolver, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
      const out = [];
      for (let i=0;i<nodes.snapshotLength;i++){
        out.push(nodes.snapshotItem(i));
      }
      return { type: 'nodes', nodes: out };
    } catch (err) {
      return { error: err.toString() };
    }
  }

  // UI elements
  const xpathInput = document.getElementById('xpathInput');
  const runBtn = document.getElementById('runBtn');
  const clearBtn = document.getElementById('clearBtn');
  const resultsEl = document.getElementById('results');
  const resultCount = document.getElementById('resultCount');
  const exampleButtons = document.querySelectorAll('.example-btn');

  function renderResult(res) {
    resultsEl.innerHTML = '';
    if (res.error) {
      resultsEl.innerHTML = '<div style="color:#b00020"><strong>Error:</strong> ' + escapeHtml(res.error) + '</div>';
      resultCount.textContent = '0';
      return;
    }
    if (res.type === 'number') {
      resultsEl.innerHTML = '<div><strong>Number:</strong> ' + res.value + '</div>';
      resultCount.textContent = '1';
      return;
    }
    if (res.type === 'string') {
      resultsEl.innerHTML = '<div><strong>String:</strong> <pre style="white-space:pre-wrap;background:#f7fbff;padding:8px;border-radius:6px">' + escapeHtml(res.value) + '</pre></div>';
      resultCount.textContent = '1';
      return;
    }
    if (res.type === 'nodes') {
      if (res.nodes.length === 0) {
        resultsEl.innerHTML = '<div class="small" style="color:#666">No nodes matched</div>';
        resultCount.textContent = '0';
        return;
      }
      resultCount.textContent = res.nodes.length;
      res.nodes.forEach(function(node, idx){
        let out = '';
        if (node.nodeType === Node.TEXT_NODE) {
          out = escapeHtml(node.nodeValue);
          resultsEl.innerHTML += '<div><strong>['+ (idx+1) +'] Text:</strong><pre style="white-space:pre-wrap;background:#fff;padding:8px;border-radius:6px;margin-top:6px">' + out + '</pre></div>';
        } else if (node.nodeType === Node.ELEMENT_NODE) {
          const serializer = new XMLSerializer();
          out = serializer.serializeToString(node);
          resultsEl.innerHTML += '<div><strong>['+ (idx+1) +'] Element:</strong><pre style="white-space:pre-wrap;background:#fff;padding:8px;border-radius:6px;margin-top:6px">' + escapeHtml(out) + '</pre></div>';
        } else {
          resultsEl.innerHTML += '<div>Node type: ' + node.nodeType + '</div>';
        }
      });
    }
  }

  function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  runBtn.addEventListener('click', function(){
    const expr = xpathInput.value.trim();
    if (!expr) return;
    const r = evaluate(expr);
    renderResult(r);
  });

  clearBtn.addEventListener('click', function(){
    xpathInput.value = '';
    resultsEl.innerHTML = '';
    resultCount.textContent = '0';
  });

  exampleButtons.forEach(function(b){
    b.addEventListener('click', function(){
      const x = this.getAttribute('data-xpath');
      xpathInput.value = x;
    });
  });

  xpathInput.addEventListener('keydown', function(e){
    if (e.key === 'Enter') { runBtn.click(); e.preventDefault(); }
  });

})();
</script>
</body>
</html>
