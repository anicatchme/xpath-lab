<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>XPath Lab — EDI Invoice</title>
<style>
  :root{--brand:#0366d6;--bg:#fff;--muted:#666}
  body{font-family:Segoe UI,Arial,Helvetica,sans-serif;margin:0;background:#f6f8fb;color:#111}
  .wrap{max-width:1100px;margin:20px auto;padding:18px;background:var(--bg);border-radius:8px;box-shadow:0 2px 8px rgba(20,30,40,0.05)}
  header{display:flex;align-items:flex-start;justify-content:space-between;gap:16px}
  h1{margin:0;color:var(--brand);font-size:20px}
  p.lead{margin:6px 0 0;color:var(--muted)}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:16px}
  .panel{background:#fff;padding:12px;border-radius:6px;border:1px solid #eef3fb}
  pre.xml{background:#0b1220;color:#cfe8ff;padding:12px;overflow:auto;border-radius:6px;font-family:Consolas,Menlo,monospace;font-size:13px;line-height:1.4}
  label{display:block;margin:8px 0 6px;font-weight:600;color:#333}
  input.xpath{width:100%;padding:8px;border-radius:6px;border:1px solid #dfeaf8;font-size:14px}
  .btn{display:inline-block;padding:8px 12px;border-radius:6px;background:var(--brand);color:#fff;text-decoration:none;border:none;cursor:pointer}
  .btn.ghost{background:#f3f8ff;color:var(--brand);border:1px solid #dbeefe}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .small{font-size:13px;color:var(--muted)}
  .results{margin-top:10px;background:#fbfcff;border:1px dashed #e3eefc;padding:10px;border-radius:6px;min-height:80px;overflow:auto}
  .task{margin-bottom:12px;padding:10px;border-radius:6px;border:1px solid #f0f4fb;background:#fbfeff}
  .solutions{margin-top:10px;background:#fff7f0;border-left:4px solid #ffb86b;padding:10px;border-radius:4px}
  .hint{font-size:13px;color:#666}
  .example-btn{font-size:13px;padding:6px 8px}
  .footer{margin-top:18px;color:var(--muted);font-size:13px}
  details{margin-top:8px}
  .code-inline{font-family:Consolas,monospace;background:#f5f7fb;padding:2px 6px;border-radius:4px;color:#0a2540}
</style>
</head>
<body>
<div class="wrap" role="main">
  <header>
    <div>
      <h1>Lab — EDI Invoice (XPath practice)</h1>
      <p class="lead">Practice extracting and validating invoice data from a realistic Invoice XML. Use the interactive tester on the right to run XPath expressions against the sample.</p>
    </div>
    <div style="text-align:right">
      <div class="small">Difficulty: <strong>Intermediate</strong></div>
      <div class="small">Estimated time: <strong>20–40 min</strong></div>
    </div>
  </header>

  <div class="grid" role="region" aria-label="lab grid">
    <!-- Left column -->
    <div>
      <div class="panel">
        <h3 style="margin:0 0 8px">How to use</h3>
        <ol style="margin:6px 0 0 18px">
          <li>Read tasks below.</li>
          <li>Type an XPath in the tester on the right and click <strong>Run</strong>.</li>
          <li>Verify results; use examples or show solutions if needed.</li>
        </ol>
        <div style="margin-top:10px" class="hint">Note: This tester uses the browser XPath engine (XPath 1.0). Numeric functions like <code>sum()</code> and comparisons may behave differently across tools.</div>
      </div>

      <div style="margin-top:12px" class="panel">
        <h3 style="margin:0 0 8px">Invoice — Sample XML</h3>
        <div class="small">This sample XML is intentionally rich: header, invoice lines, taxes, references, and payment terms. Download as <span class="code-inline">invoice-sample.xml</span> if needed.</div>
        <pre class="xml" id="xmlSample" aria-label="Invoice sample XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Invoice&gt;
  &lt;Header&gt;
    &lt;InvoiceNumber&gt;INV-2025-9001&lt;/InvoiceNumber&gt;
    &lt;InvoiceDate&gt;2025-12-05&lt;/InvoiceDate&gt;
    &lt;InvoiceType&gt;Commercial&lt;/InvoiceType&gt;
    &lt;Seller&gt;
      &lt;Party id="SELL-77"&gt;
        &lt;Name&gt;SupplyCo&lt;/Name&gt;
        &lt;TaxID&gt;US-987654321&lt;/TaxID&gt;
        &lt;Address&gt;
          &lt;Street&gt;5 Industrial Way&lt;/Street&gt;
          &lt;City&gt;Gotham&lt;/City&gt;
          &lt;Country&gt;US&lt;/Country&gt;
        &lt;/Address&gt;
      &lt;/Party&gt;
    &lt;/Seller&gt;
    &lt;Buyer&gt;
      &lt;Party&gt;
        &lt;Name&gt;Acme Corp&lt;/Name&gt;
        &lt;Address&gt;
          &lt;Street&gt;100 Main St&lt;/Street&gt;
          &lt;City&gt;Metropolis&lt;/City&gt;
          &lt;Country&gt;US&lt;/Country&gt;
        &lt;/Address&gt;
      &lt;/Party&gt;
    &lt;/Buyer&gt;
    &lt;References&gt;
      &lt;PONumber&gt;PO-2025-00123&lt;/PONumber&gt;
      &lt;DeliveryNote&gt;DN-5557&lt;/DeliveryNote&gt;
    &lt;/References&gt;
  &lt;/Header&gt;

  &lt;InvoiceLines&gt;
    &lt;Line number="1"&gt;
      &lt;Description&gt;14-inch Laptop&lt;/Description&gt;
      &lt;Quantity&gt;2&lt;/Quantity&gt;
      &lt;UnitPrice currency="USD"&gt;1200.00&lt;/UnitPrice&gt;
      &lt;LineTax rate="0.10"&gt;240.00&lt;/LineTax&gt;
      &lt;LineTotal currency="USD"&gt;2640.00&lt;/LineTotal&gt;
    &lt;/Line&gt;

    &lt;Line number="2"&gt;
      &lt;Description&gt;Wireless Mouse&lt;/Description&gt;
      &lt;Quantity&gt;5&lt;/Quantity&gt;
      &lt;UnitPrice currency="USD"&gt;25.00&lt;/UnitPrice&gt;
      &lt;LineTax rate="0.08"&gt;10.00&lt;/LineTax&gt;
      &lt;LineTotal currency="USD"&gt;135.00&lt;/LineTotal&gt;
    &lt;/Line&gt;

      &lt;Line number="3"&gt;
      &lt;Description&gt;27-inch Monitor&lt;/Description&gt;
      &lt;Quantity&gt;2&lt;/Quantity&gt;
      &lt;UnitPrice currency="USD"&gt;350.00&lt;/UnitPrice&gt;
      &lt;LineTax rate="0.10"&gt;70.00&lt;/LineTax&gt;
      &lt;LineTotal currency="USD"&gt;770.00&lt;/LineTotal&gt;
    &lt;/Line&gt;

    &lt;Line number="4"&gt;
      &lt;Description&gt;USB-C Dock&lt;/Description&gt;
      &lt;Quantity&gt;3&lt;/Quantity&gt;
      &lt;UnitPrice currency="USD"&gt;150.00&lt;/UnitPrice&gt;
      &lt;LineTax rate="0.10"&gt;45.00&lt;/LineTax&gt;
      &lt;LineTotal currency="USD"&gt;495.00&lt;/LineTotal&gt;
    &lt;/Line&gt;

  &lt;/InvoiceLines&gt;

  &lt;Summary&gt;
    &lt;SubTotal currency="USD"&gt;3540.00&lt;/SubTotal&gt;
    &lt;TotalTax currency="USD"&gt;365.00&lt;/TotalTax&gt;
    &lt;InvoiceTotal currency="USD"&gt;3905.00&lt;/InvoiceTotal&gt;
    &lt;PaymentTerms&gt;Net 30&lt;/PaymentTerms&gt;
    &lt;DueDate&gt;2026-01-04&lt;/DueDate&gt;
  &lt;/Summary&gt;

  &lt;Notes&gt;
    &lt;Note&gt;Thank you for your business&lt;/Note&gt;
  &lt;/Notes&gt;
&lt;/Invoice&gt;</pre>
      </div>

      <div style="margin-top:12px">
        <div class="panel">
          <h3 style="margin:0 0 8px">Lab Tasks — Invoice</h3>

          <div class="task">
            <h4>Task 1 — Header extraction</h4>
            <ol style="margin:6px 0 0 18px">
              <li>Extract Invoice Number and Invoice Date.</li>
              <li>Get Seller Name and Seller TaxID.</li>
              <li>Get referenced Purchase Order number.</li>
            </ol>
          </div>

          <div class="task">
            <h4>Task 2 — Line details</h4>
            <ol style="margin:6px 0 0 18px">
              <li>Get the Description for line number = 3.</li>
              <li>List quantities for all lines.</li>
              <li>Count how many line entries exist.</li>
            </ol>
          </div>

          <div class="task">
            <h4>Task 3 — Totals & validation</h4>
            <ol style="margin:6px 0 0 18px">
              <li>Get <code>&lt;InvoiceTotal&gt;</code> and compare it to SubTotal + TotalTax (manual check).</li>
              <li>Find any line where <code>LineTax rate &gt; 0.09</code>.</li>
              <li>Get currency code used in totals.</li>
            </ol>
          </div>

          <div class="task">
            <h4>Task 4 — Payment & references</h4>
            <ol style="margin:6px 0 0 18px">
              <li>Extract PaymentTerms and DueDate.</li>
              <li>Find the Delivery Note reference.</li>
            </ol>
          </div>

          <details>
            <summary style="cursor:pointer;font-weight:600">Show solutions (click to reveal)</summary>
            <div class="solutions">
              <div><strong>Answers (XPath expressions)</strong></div>
              <ol style="margin:6px 0 0 18px">
                <li><code>//Header/InvoiceNumber/text()</code> &amp; <code>//Header/InvoiceDate/text()</code></li>
                <li><code>//Header/Seller/Party/Name/text()</code> &amp; <code>//Header/Seller/Party/TaxID/text()</code></li>
                <li><code>//Header/References/PONumber/text()</code></li>

                <li><code>//InvoiceLines/Line[@number='3']/Description/text()</code></li>
                <li><code>//InvoiceLines/Line/Quantity/text()</code> (or use nodes and map)</li>
                <li><code>count(//InvoiceLines/Line)</code></li>

                <li><code>//Summary/InvoiceTotal/text()</code> (compare to SubTotal + TotalTax)</li>
                <li><code>//InvoiceLines/Line[number(./LineTax/@rate) &gt; 0.09]/Description/text()</code></li>
                <li><code>//Summary/SubTotal/@currency</code> or <code>//Summary/InvoiceTotal/@currency</code></li>

                <li><code>//Summary/PaymentTerms/text()</code> &amp; <code>//Summary/DueDate/text()</code></li>
                <li><code>//Header/References/DeliveryNote/text()</code></li>
              </ol>
              <div class="hint" style="margin-top:8px">Note: XPath numeric conversions may need <code>number()</code> in some engines. Browser XPath often allows comparisons directly if conversion makes sense.</div>
            </div>
          </details>

        </div>
      </div>

      <div class="footer small">Lab LVT Magus: XPath Workshop — extend this lab for namespace-aware EDI formats (cXML/UBL) in advanced modules.</div>
    </div>

    <!-- Right column: interactive tester -->
    <aside>
      <div class="panel" aria-label="XPath tester">
        <label for="xpathInput">Type XPath expression</label>
        <input id="xpathInput" class="xpath" value="//Header/InvoiceNumber/text()" aria-label="XPath expression"/>
        <div class="controls" style="margin-top:8px">
          <button id="runBtn" class="btn">Run</button>
          <button id="clearBtn" class="btn ghost" style="color:var(--brand)">Clear</button>
          <button id="examplesBtn" class="btn ghost" title="Insert example XPaths">Examples</button>
        </div>

        <div style="margin-top:10px" class="small">Results (<span id="resultCount">0</span>)</div>
        <div id="results" class="results" role="region" aria-live="polite"></div>

        <details style="margin-top:10px">
          <summary style="cursor:pointer">Examples</summary>
          <div style="margin-top:8px;display:flex;flex-direction:column;gap:6px">
            <button class="example-btn btn ghost" data-xpath="//Header/InvoiceNumber/text()">Invoice Number</button>
            <button class="example-btn btn ghost" data-xpath="//Header/Seller/Party/Name/text()">Seller Name</button>
            <button class="example-btn btn ghost" data-xpath="//InvoiceLines/Line[@number='3']/Description/text()">Line 3 Description</button>
            <button class="example-btn btn ghost" data-xpath="count(//InvoiceLines/Line)">Count Lines</button>
            <button class="example-btn btn ghost" data-xpath="//InvoiceLines/Line[number(Quantity) &gt; 2]/Description/text()">Quantity > 2</button>
            <button class="example-btn btn ghost" data-xpath="//Summary/InvoiceTotal/text()">Invoice Total</button>
          </div>
        </details>

      </div>

      <div style="margin-top:12px" class="panel">
        <h4 style="margin:0 0 8px">Tester notes</h4>
        <ul style="margin:6px 0 0 18px" class="small">
          <li>Expressions run against the sample XML shown on the left.</li>
          <li>Element text nodes and serialized elements are shown.</li>
          <li>For numeric comparisons you may need <code>number()</code> depending on the engine.</li>
        </ul>
      </div>

    </aside>
  </div>
</div>

<script>
(function(){
  // Grab sample XML from the pre block
  const xmlText = document.getElementById('xmlSample').textContent.trim();
  let xmlDoc = null;
  function parseXML() {
    try {
      const parser = new DOMParser();
      xmlDoc = parser.parseFromString(xmlText, "application/xml");
      const parsererror = xmlDoc.getElementsByTagName('parsererror');
      if (parsererror.length) {
        throw new Error('XML parse error');
      }
    } catch (e) {
      xmlDoc = null;
      console.error('XML parse failed', e);
    }
  }
  parseXML();

  function evaluate(xpath) {
    if (!xmlDoc) return { error: 'XML not parsed' };
    try {
      const nsResolver = xmlDoc.createNSResolver(xmlDoc.documentElement);
      // Try number (for sum/count)
      const numberResult = xmlDoc.evaluate(xpath, xmlDoc, nsResolver, XPathResult.NUMBER_TYPE, null);
      if (!isNaN(numberResult.numberValue) && String(numberResult.numberValue) !== 'NaN') {
        return { type: 'number', value: numberResult.numberValue };
      }
      // Try string
      const stringResult = xmlDoc.evaluate(xpath, xmlDoc, nsResolver, XPathResult.STRING_TYPE, null);
      if (stringResult.stringValue && stringResult.stringValue !== '') {
        return { type: 'string', value: stringResult.stringValue };
      }
      // Node set
      const nodes = xmlDoc.evaluate(xpath, xmlDoc, nsResolver, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
      const out = [];
      for (let i=0;i<nodes.snapshotLength;i++){
        out.push(nodes.snapshotItem(i));
      }
      return { type: 'nodes', nodes: out };
    } catch (err) {
      return { error: err.toString() };
    }
  }

  // UI elements
  const xpathInput = document.getElementById('xpathInput');
  const runBtn = document.getElementById('runBtn');
  const clearBtn = document.getElementById('clearBtn');
  const resultsEl = document.getElementById('results');
  const resultCount = document.getElementById('resultCount');
  const exampleButtons = document.querySelectorAll('.example-btn');

  function renderResult(res) {
    resultsEl.innerHTML = '';
    if (res.error) {
      resultsEl.innerHTML = '<div style="color:#b00020"><strong>Error:</strong> ' + escapeHtml(res.error) + '</div>';
      resultCount.textContent = '0';
      return;
    }
    if (res.type === 'number') {
      resultsEl.innerHTML = '<div><strong>Number:</strong> ' + res.value + '</div>';
      resultCount.textContent = '1';
      return;
    }
    if (res.type === 'string') {
      resultsEl.innerHTML = '<div><strong>String:</strong> <pre style="white-space:pre-wrap;background:#f7fbff;padding:8px;border-radius:6px">' + escapeHtml(res.value) + '</pre></div>';
      resultCount.textContent = '1';
      return;
    }
    if (res.type === 'nodes') {
      if (res.nodes.length === 0) {
        resultsEl.innerHTML = '<div class="small" style="color:#666">No nodes matched</div>';
        resultCount.textContent = '0';
        return;
      }
      resultCount.textContent = res.nodes.length;
      res.nodes.forEach(function(node, idx){
        let out = '';
        if (node.nodeType === Node.TEXT_NODE) {
          out = escapeHtml(node.nodeValue);
          resultsEl.innerHTML += '<div><strong>['+ (idx+1) +'] Text:</strong><pre style="white-space:pre-wrap;background:#fff;padding:8px;border-radius:6px;margin-top:6px">' + out + '</pre></div>';
        } else if (node.nodeType === Node.ELEMENT_NODE) {
          const serializer = new XMLSerializer();
          out = serializer.serializeToString(node);
          resultsEl.innerHTML += '<div><strong>['+ (idx+1) +'] Element:</strong><pre style="white-space:pre-wrap;background:#fff;padding:8px;border-radius:6px;margin-top:6px">' + escapeHtml(out) + '</pre></div>';
        } else {
          resultsEl.innerHTML += '<div>Node type: ' + node.nodeType + '</div>';
        }
      });
    }
  }

  function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  runBtn.addEventListener('click', function(){
    const expr = xpathInput.value.trim();
    if (!expr) return;
    const r = evaluate(expr);
    renderResult(r);
  });

  clearBtn.addEventListener('click', function(){
    xpathInput.value = '';
    resultsEl.innerHTML = '';
    resultCount.textContent = '0';
  });

  exampleButtons.forEach(function(b){
    b.addEventListener('click', function(){
      const x = this.getAttribute('data-xpath');
      xpathInput.value = x;
    });
  });

  xpathInput.addEventListener('keydown', function(e){
    if (e.key === 'Enter') { runBtn.click(); e.preventDefault(); }
  });

})();
</script>
</body>
</html>
